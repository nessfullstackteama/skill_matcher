node {
    def app
    
    agent {
        docker {
            image 'node:10-alpine' 
            args '-p 3000:3000' 
        }
    }

    stage('Clone repository') {
        checkout scm
    }

    stage('Build image') {
        dir('frontend') {
            dir('app') {
                sh 'npm prune'
                sh 'npm install'
            }

            app = docker.build("nessfullstackteama/skill_matcher_fe:0.1.${env.BUILD_NUMBER}")
            sh "docker tag nessfullstackteama/skill_matcher_fe:0.1.${env.BUILD_NUMBER} nessfullstackteama/skill_matcher_fe:latest"
        }
    }

    stage('Test image') {
        app.inside {
            sh 'echo OK' //'curl -i http://127.0.0.1/nginx_status'
        }
    }
}